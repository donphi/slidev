# Optimized local development setup
# For FASTEST HMR, run Slidev natively: cd presentation && npm run dev:local
#
# If you must use Docker, this setup provides the best HMR experience:
# Run: docker-compose -f docker-compose.local.yml up --build

services:
  # Slidev presentation with optimized file watching
  slidev:
    build:
      context: ./presentation
      dockerfile: Dockerfile.local
    ports:
      - "3030:3030"
    volumes:
      # Mount entire presentation folder for fast HMR
      # This allows native file watching instead of copying files
      - ./presentation:/app:cached
      # Don't override node_modules (use container's version)
      - /app/node_modules
    environment:
      # CRITICAL: Disable polling on Linux (uses fast inotify)
      # Enable polling only on Windows/macOS Docker Desktop
      - CHOKIDAR_USEPOLLING=${CHOKIDAR_USEPOLLING:-false}
      # Vite needs this to know it's in a container
      - VITE_DEV_SERVER_HOST=0.0.0.0
    # Use tini for proper signal handling (faster shutdown)
    init: true

  # Editor service
  editor:
    build:
      context: ./editor
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - SLIDES_PATH=/app/presentation/slides.md
      - SLIDEV_URL=http://slidev:3030
    volumes:
      - ./presentation/slides.md:/app/presentation/slides.md
      - ./presentation/style.css:/app/presentation/style.css
    depends_on:
      - slidev
    init: true

networks:
  default:
    name: slidev-dev

