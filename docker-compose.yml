# Local development - uses the same combined approach as Railway
# Run: docker-compose up --build

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.railway
    ports:
      - "3000:3000"
    volumes:
      # Mount to the SAME location Slidev uses (/app/presentation/)
      # This allows live editing while keeping paths consistent with Railway
      - ./presentation/slides.md:/app/presentation/slides.md
      - ./presentation/style.css:/app/presentation/style.css
    environment:
      - PORT=3000
      # Use the SAME paths as Dockerfile.railway - NO /app/userdata/ override
      # Slidev runs from /app/presentation/, so editor must read/write there too
      - SLIDES_PATH=/app/presentation/slides.md
      - STYLE_PATH=/app/presentation/style.css
      - SLIDEV_DIR=/app/presentation
      - SLIDEV_URL=http://localhost:3030
      # =====================================================
      # DEBUG/VERBOSE LOGGING
      # =====================================================
      - VITE_DEBUG=true
      # Set a password to protect the editor (leave empty for no auth)
      - EDITOR_PASSWORD=${EDITOR_PASSWORD:-}
      # Number of backup versions to keep (default: 10)
      - MAX_HISTORY=${MAX_HISTORY:-10}
      # Database URL for persistent storage (optional)
      - DATABASE_URL=${DATABASE_URL:-}
      # =====================================================
      # FILE WATCHING CONFIGURATION
      # =====================================================
      # Linux (native Docker): Use inotify for instant HMR (FAST!)
      # Docker Desktop (Windows/macOS): Requires polling (SLOWER)
      # 
      # If you're on Windows/macOS with Docker Desktop, uncomment:
      # - CHOKIDAR_USEPOLLING=true
      # 
      # Default: false (uses fast native file events on Linux)
      - CHOKIDAR_USEPOLLING=${CHOKIDAR_USEPOLLING:-false}
    restart: unless-stopped